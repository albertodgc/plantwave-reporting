<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Plant Wave – Revenue per Recipient</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
body{
  font-family: system-ui, -apple-system, sans-serif;
  background:#f4f6f9;
  margin:0;
  padding:40px;
  color:#111;
}

.container{
  max-width:1200px;
  margin:auto;
}

.card{
  background:#fff;
  padding:30px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

h1{
  font-size:26px;
  margin-bottom:6px;
}

.sub{
  font-size:14px;
  color:#666;
  margin-bottom:25px;
}

.controls{
  margin-bottom:25px;
  display:flex;
  gap:12px;
}

button{
  padding:10px 16px;
  border-radius:10px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
  font-size:14px;
  font-weight:500;
}

button:hover{
  background:#f0f0f0;
}

.chart-wrapper{
  height:500px;
  margin-bottom:30px;
}

.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
  margin-bottom:30px;
}

.stat{
  background:#f8fafc;
  padding:18px;
  border-radius:14px;
}

.stat .label{
  font-size:13px;
  color:#666;
  margin-bottom:6px;
}

.stat .value{
  font-size:22px;
  font-weight:700;
}

.table-wrapper{
  overflow-x:auto;
  border-top:1px solid #eee;
  padding-top:20px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

th, td{
  padding:10px;
  text-align:center;
  border-bottom:1px solid #eee;
}

th{
  background:#f8fafc;
  font-weight:600;
}

tr:hover{
  background:#f9fbff;
}

@media (max-width:900px){
  .stats{
    grid-template-columns:repeat(2,1fr);
  }
}
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h1>Plant Wave – Revenue per Recipient</h1>
    <div class="sub">Feb 2024 – Jan 2026 | Monthly Performance</div>

    <div class="controls">
      <button onclick="toggleRolling()">Toggle 3-Month Rolling Avg</button>
      <button onclick="downloadChart()">Download PNG</button>
    </div>

    <div class="chart-wrapper">
      <canvas id="chart"></canvas>
    </div>

    <div class="stats" id="stats"></div>

    <div class="table-wrapper">
      <h3 style="margin-bottom:12px;">Monthly Data</h3>
      <table id="dataTable">
        <thead>
          <tr>
            <th>Month</th>
            <th>Revenue per Recipient ($)</th>
            <th>MoM Change</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>
</div>

<script>
const labels = [
"Feb 2024","Mar 2024","Apr 2024","May 2024","Jun 2024","Jul 2024","Aug 2024",
"Sep 2024","Oct 2024","Nov 2024","Dec 2024","Jan 2025","Feb 2025","Mar 2025",
"Apr 2025","May 2025","Jun 2025","Jul 2025","Aug 2025","Sep 2025","Oct 2025",
"Nov 2025","Dec 2025","Jan 2026"
];

const values = [
0.0451,0.0417,0.0584,0.0390,0.0468,0.0482,0.0428,0.0249,
0.0727,0.1170,0.0632,0.0215,0.0346,0.0333,0.0343,0.0178,
0.0420,0.0248,0.0249,0.0246,0.0189,0.0207,0.0582,0.0160
];

function rollingAvg(data){
  return data.map((_,i)=>{
    if(i<2) return null;
    return (data[i]+data[i-1]+data[i-2])/3;
  });
}

function format(n){ return "$"+n.toFixed(4); }

function percentChange(current,prev){
  if(prev===undefined) return "-";
  const p=((current-prev)/prev)*100;
  return (p>0?"+":"")+p.toFixed(1)+"%";
}

const rolling = rollingAvg(values);

const ctx=document.getElementById("chart").getContext("2d");

const chart=new Chart(ctx,{
  data:{
    labels:labels,
    datasets:[
      {
        type:'bar',
        label:'Revenue per Recipient',
        data:values,
        backgroundColor:'rgba(59,130,246,0.45)',
        borderRadius:6
      },
      {
        type:'line',
        label:'Trend',
        data:values,
        borderColor:'#1d4ed8',
        borderWidth:3,
        pointRadius:4,
        tension:0.25
      },
      {
        type:'line',
        label:'3M Rolling Avg',
        data:rolling,
        borderColor:'#ef4444',
        borderDash:[6,6],
        borderWidth:3,
        tension:0.3,
        hidden:true
      }
    ]
  },
  options:{
    responsive:true,
    maintainAspectRatio:false,
    interaction:{mode:'index',intersect:false},
    scales:{
      y:{
        beginAtZero:true,
        ticks:{
          callback:(v)=>"$"+v.toFixed(2)
        }
      }
    }
  }
});

function toggleRolling(){
  chart.data.datasets[2].hidden=!chart.data.datasets[2].hidden;
  chart.update();
}

function downloadChart(){
  const a=document.createElement('a');
  a.href=chart.toBase64Image();
  a.download="plant-wave-revenue-per-recipient.png";
  a.click();
}

function renderStats(){
  const latest=values[values.length-1];
  const prev=values[values.length-2];
  const max=Math.max(...values);
  const avg=values.reduce((a,b)=>a+b)/values.length;
  const peakMonth=labels[values.indexOf(max)];

  document.getElementById("stats").innerHTML=`
  <div class="stat"><div class="label">Latest (Jan 2026)</div><div class="value">${format(latest)}</div></div>
  <div class="stat"><div class="label">MoM Change</div><div class="value">${percentChange(latest,prev)}</div></div>
  <div class="stat"><div class="label">24-Month Avg</div><div class="value">${format(avg)}</div></div>
  <div class="stat"><div class="label">Peak Month (${peakMonth})</div><div class="value">${format(max)}</div></div>
  `;
}

function renderTable(){
  const tbody=document.querySelector("#dataTable tbody");
  labels.forEach((month,i)=>{
    const row=document.createElement("tr");
    row.innerHTML=`
      <td>${month}</td>
      <td>${format(values[i])}</td>
      <td>${percentChange(values[i],values[i-1])}</td>
    `;
    tbody.appendChild(row);
  });
}

renderStats();
renderTable();
</script>

</body>
</html>
